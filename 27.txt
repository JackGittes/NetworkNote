计算机网络原理笔记 27
局域网技术（七）
作者：赵明心    日期：2019/03/17

网桥也是互连设备，虽然不像路由器、网关层次那么高，但是也属于互连设备，集线器、中继器所处层次比网桥更低。网桥位于数据链路层。

注意的是，网桥互联对象可以是同构的也可以是异构的，网桥转发的数据帧，以完整接收数据帧之后依据目标MAC地址以及网桥内部自动维护的数据端口转发表来选择转发地址。网桥因此具有过滤帧的功能，可以依据数据帧将其送往应该送达的位置。例如A发送数据给B，并不希望CDE接收，网桥在转发的时候就可以做到。

物理层的转发设备集线器就无法实现过滤功能，只能进行广播转发，无法做到哪些广播哪些不广播，所有接收方都可以接收数据。

5.5.1   网桥连接及内部结构

网段A和网段B之间如果AB的网络类型不同，可以依靠网桥连接，例如A是以太网，B是令牌环网，这时候可以借助网桥进行连接，而不能在物理层进行直接连接。

网桥的端口数量不多，所以网桥是用于连接网段的，不是用于连接主机的。

网桥
 |                          站表-----------> 站地址  端口
 |                           |                ①     1
 |                           |                ②     1
 |                           |                ③     1
 |      端口管理软件<-----> 网桥协议实体          ④     2
 |                           |                ⑤     2
 |                           |                ⑥     2
 |               端口1<----->缓存<------->端口2
 |                 |                      |
 |
 |
 |---------------
      |         |
    网段A      网段B

每个端口有对应的缓存，可以实现基于存储转发的方式转发数据，缓存区域接收到数据帧之后进行路径选择，这个路径选择比较简单，只需要选择合适的输出端口就可以，站表中具有网络中对应的端口号，可以确定目标方在哪个端口。网桥中具有一些端口管理软件和协议实体，例如实现异构网络的连接时的协议转换，还有实现数据端口转发表的动态更新。

5.5.2   网桥优点
    1、过滤通信量
    2、扩大了物理范围
    3、提高了可靠性
    4、可互联不同物理层、不同MAC子层和不同速率（如10Mb/s和100Mb/s以太网）的局域网

    过滤通信并不意味着接收到的数据只能从一个端口进行输出，也可以进行多个端口输出。局域网中的地址类型有单播、多播、广播三种地址类型，单播地址类型只能从一个端口转发出去，而对于多播和广播来说，所有端口应该全部输出，过滤通信量主要针对的是单播通信。现实中，单播的数据量是最大的，占据绝大部分比例，多播和广播也存在，但是较少。广播一般只在小范围中存在，广播域不会很大，在小范围的所有节点可以进行接收。主播（多播）的成员是具有选择性的。

    CSMA/CD协议具有最大跨距限制，通信距离不能太长，使用中继器不能解决问题，这不是衰减和失真的问题，是冲突造成的媒体访问控制问题，但这个时候就可以使用网桥，网桥连接之后，每个连接的部分网段都是一个单一的CSMA/CD碰撞域，每个碰撞域通过网桥扩展自己的范围。中继器只能在碰撞域内部来扩展网络范围。

    这就是网桥扩大网络物理范围和中继器扩大网络物理范围的不同之处。不同碰撞域之间可以独立工作，而且一个碰撞域出现故障不会影响连接到网桥端口上的其他网段。

    仅仅因为距离和容量不同造成的网络不同，仍然是同构的网络，而不是异构网络。例如在一个单位中，需要两个网络才能容纳足够的用户，但是两个网络在技术层面没有差异，这个时候两个网络的连接就属于同构连接。也存在这种可能，在一个企业中，生产部门和技术部门由于对网络的安全性，通信效率的需求不同，这时候可能使用异构的网络连接，网桥就可以实现异构连接。

    现在的高档路由器可能支持多种网络协议，实现多种网络协议的转换，实现异构网络互联。

5.5.3   网桥缺点
    1、存储转发增加了时延
    2、在MAC子层并没有流量控制功能
    3、具有不同MAC子层的网段桥接在一起时时延更大
    4、网桥只适合于用户数不太多（不超过几百个）和通信量不太大的局域网，否则有时还会因传播过多的广播信息而产生网络拥塞。这就是所谓的广播风暴。

    低速网络向高速网络发送不存在失配问题，但是反过来就会有问题，今天的末端设备中增加了一些流量控制功能。异构网络的时延更大，多一个协议转换时间，这个过程有时候还比较复杂，协议数据单元比较复杂造成耗时增加。

    综合网桥的优势和缺陷，网桥只适用于用户数不多、通信量不大的局域网。业务广播需求量相对于单播需求量来说是较低的，但是要注意用户数目问题，每个用户的广播需求不大，但是用户数多了之后广播数就很可观了。

    10M局域网不仅可以构建局域网还可以构建广域网，现在局域网和广域网的界限在变得模糊，两者的技术在不断地融合。

5.5.4   网桥与集线器的区别
    1、集线器在转发帧时，不对传输媒体进行检测
    2、网桥在转发帧之前必须执行CSMA/CD算法
        （1）若在发送过程中出现碰撞，就必须停止发送和进行退避
        （2）在这一点上网桥的接口很像一个网卡，但网桥却没有网卡
    3、由于网桥没有网卡，因此网桥并不改变它转发的帧的源地址

    网桥的不同端口之间可以进行并发通信，而集线器是不可以的。两者之间进行独立通信，每段都需要进行载波侦听检测。网桥端口虽然像网卡一样要进行检测侦听，像是在独立进行媒体访问控制，但是网桥不具有MAC地址。

    使用网桥不需要进行配置。

5.5.5   透明网桥/生成树网桥
    1、网桥工作在混杂(promiscuous)方式
    2、网桥接收到一帧后，通过“查询地址/端口对应表”来确定是丢弃还是转发
    3、网桥刚启动时，地址/端口对应表为空，采用洪泛方法转发帧
    4、在转发过程中采用逆向学习算法收集MAC地址。网桥通过分析帧的源MAC地址得到MAC地址与端口的对应关系，并写入地址/端口对应表
    5、网桥软件对地址/端口对应表进行不断的更新，并定时检查，删除在一段时间内没有更新的地址/端口项

    端口地址表是动态变化的，需要有一定的算法策略。逆向地址学习可以创建维护地址表，但是刚启动的时候，地址表为空，没有表项，洪泛方法实际就是广播的方法，直接对所有端口进行广播，目标方肯定能接收到数据。