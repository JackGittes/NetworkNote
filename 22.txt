计算机网络原理笔记 22
局域网技术（二）
作者：赵明心    日期：2019/03/07

按照OSI模型，在一个层次当中，根据层次需要可以进一步划分子层，802就划分了子层。802将数据链路层划分了两个子层。

5.2.3   802数据链路层划分子层的目的
    1、将功能中与硬件相关的部分和硬件无关的部分分开，降低实现的复杂度
    2、局域网特点：共享信道（如总线）。需要解决介质访问控制（MAC）问题。子层划分可以使帧的传输独立于介质和MAC方法。
    （1）LLC：与介质、拓扑无关
    （2）MAC：与介质、拓扑相关

    802.3~6都和共享信道访问策略相关，所谓共享信道，本质就是物理媒介，这些具体实现都是电路形式的，媒体访问控制部分不是单一的，而是有很多种，如果每种独立向上提供服务，那么就会在上层产生多种接口，在使用的时候就会变得非常复杂化，自然而然地需要一个屏蔽不同媒介访问方法的层次。上层实体需要使用媒介传输数据的时候，可以使用统一的服务接口来进行。

    为了更清晰地说明这个道理，举个例子。无论是802.3~6，用户使用的时候，用户使用的都是一个主机设备加网卡，并连接一个介质。从外观使用上来看，是没有区别的。但是实际上802.3和802.4的网卡是不同的，网卡内部的实现是不一样的，网络的应用程序跟底层的网卡实现无关。应用程序无需关心底层是以太网网卡还是令牌环网网卡。这个中间的屏蔽层就在网卡驱动程序，网卡的驱动程序肯定是不同的，不同的设备驱动一般是不同的（有时候同一个厂商的产品因为具有前后兼容性，使得旧版本驱动有可能在新版本底层硬件上使用），驱动程序是不同的，但是网卡驱动对上接口是相同的。

    上层通过驱动程序来对实际硬件进行控制。这样就使得服务访问的接口完全一致。同样的，在802体系中的逻辑控制子层就起到了屏蔽作用，用户无需关心MAC的实现方式。

    先看MAC子层，MAC协议标准是很多的，但是逻辑链路控制子层标准是单一的，一个协议标准就可以提供上层接口。不过LLC的对下接口也是很多的，因为需要适应多种MAC。

5.2.4   LLC与MAC的关系
    LLC子层看不见下面的局域网。

             网络层               网络层
逻辑链路控制    LLC   <---------->  LLC
媒体接入控制    MAC   <<< 局域网 >>> MAC     
              物理层 <<< 局域网 >>> 物理层              
              
              站点1                站点2
    
    MAC层多种多样，但是网络层不需要多个，网络层协议例如IP协议只需要一种，没有以太网IP协议和令牌环网IP协议的区别。从原理上来讲是这样的，但是实际上，在网络上捕获协议包的时候，例如使用sniffer等，可以发现，IP数据会被MAC封装，而LLC不见了，逻辑链路控制子层不存在是为什么？今天的LLC功能已经被削弱了，已经接近于没有，LLC子层在802.3中已经快消失了。

    实际网络控制协议的实现中，基本已经取消了LLC子层。从原理上来讲是需要LLC子层的，但是从今天的以太网的发展来看，已经很少见到非以太网的产品，也就是反推过来，我们能接触到的MAC层基本就只有以太网。有线以太网覆盖率已经达到98%以上，其他的MAC协议已经没有必要去实现了。我们能看到的差不多只有802.3而没有802.4。为了简化实现，这个LLC是可以取消的。

5.2.5   802网络体系各层功能
    1、物理层功能
    （1）信号的编码、译码
    （2）前导码的生成、去除
    （3）比特的发送、接收
    2、数据链路层功能
    （1）MAC子层：成帧/拆帧，实现、维护MAC协议，位差错检测、寻址
    （2）LLC子层：向高层提供SAP，建立/释放逻辑连接，差错控制，帧序号处理，提供某些网络层功能

    物理层功能在802在与OSI对比中可以看到，物理层基本没有差异。这里的信号编码、译码不是调制解调，不是将基带信号变成频带信号，而是把PC内部的方波信号编码成可以在线路上传输的方波信号。PC机内部的方波信号带宽利用率非常高，因为主机内部信号传输距离比较短，总线长度一般不超过1米、2米，方波信号一般需要有一个统一时钟控制，这样才可以精确确定起始点和终止点。而在计算机网络中，没有要求传输时钟信号，而且各个计算机结点也没有时钟同步，所以需要实现自同步周期划分。例如以太网中使用的曼彻斯特编码，就可以完成自同步功能。

    前导码的生成和删除，链路层发送的数据帧，帧是有效数据，对物理层而言就是有效负载，物理层不存在头部控制，因为物理层的基本数据单元是0\1位，这个是数字电路上的原子单位，因为没有更小的协议控制数据，物理层在接收到了链路层数据之后如果直接对其进行发送会存在问题。

    要注意物理线路上，收发双方没有时钟同步控制，二者之间需要进行同步。这个就需要通过类似握手的过程，本质是一个预先准备过程，类似起跑的时候进行发令准备。预准备数据就是发送端发送前导码，前导码不是真实的链路层附载数据，前导码实现的是发送端和接收端的数据同步，正常的可靠的数据传输不允许丢失任何一个位，丢失一个位都意味这数据错误。

    例如发送端发送了10个前导码，而接收端只接收了9个，也是可以接受的，是符合要求的，因为前导码并不影响真实数据的传输。最后接收到的前导码还需要进行去除。

    链路层都需要实现成帧机制，任何链路层协议都必须要有成帧机制。再者是实现MAC协议，在广播共享信道中要详细讲述访问方式，不同方式的代价和利用效率都不同。位差错检测简单来说就是检测差错，在现在的局域网中只有检测，没有纠正，检测很容易实现，纠错实现的代价非常大。包括算法实现和通信负载开销，都非常大。出错重传的时候，如果硬件问题等导致总是出现错误，就无法纠错了。最后一个是寻址功能，局域网中共享广播信道的有多个用户，首先要有地址编排方案，再者按照地址方案进行寻找目标方。

    MAC子层的这些功能，按照局域网的功能，可以完成数据传输吗？在一切正常的情况下是可以完成传递的。MAC的功能已经能保证数据的传输了。但是按照MAC层的功能不能保证传输的质量，不过至少可以保证是能进行传输的。LLC子层向上提供服务访问点的功能实际对每个子层来说都是有的，要注意建立释放逻辑连接意味着LLC可以建立面向连接的服务，而MAC子层只能提供无连接服务。差错控制是OSI设计的一个缺陷，各层之间实际上会有重复的功能出现，链路层有差错处理，IP层也有差错处理，TCP层也有，应用层一般没有，TCP已经可以提供可靠的数据传输了。

    帧序号处理可以完成保序号功能，实现按序投递、阻止发送。

5.2.6   逻辑链路控制子层LLC（1）
    1、LLC帧格式（控制信息与HDLC大同小异）

     1        1         1/2           长度无限制         单位：字节
    DSAP     SSAP       控制             数据         

    LLC    PDU
                      |  高层PDU  |
            | LLC首部  |  LLC数据  |
    MAC首部 |         MAC数据      |   MAC尾部    
                   LLC帧与MAC帧的关系
    2、服务访问点（SAP）
    （1）LLC SAP：向上层提供进程访问能力
    （2）MAC SAP：MAC地址（即网卡地址）
    
    3、LLC提供的服务类型
    （1）LLC1 不确认无连接的服务
    （2）LLC2 面向连接的服务
    （3）LLC3 带确认无连接的服务
    （4）LLC4 高速传输服务（1991年专为城域网提出）

    LLC的服务访问点实际是编程中类似TCP编程中的端口号，类似但是不相同。逻辑链路控制子层可以向上层提供多种服务类型。MAC层的服务类型是单一的，只有一种服务，是无确认无连接服务。802.3标准的MAC服务就是不确认无连接的。

    IP协议今天基本覆盖了所有主机，IP层提供的服务也是不确认无连接的服务，这种服务也称为best effect service，即尽力而为的服务。这种服务是无保障且不可靠的。LLC可以借助本层的控制功能将MAC改造成面向连接的。这个关系和TCP、IP的关系很相似。TCP在IP基础之上建立可靠的面向连接的服务。

5.3 信道共享技术
    局域网最核心特征就是范围小，容纳节点少，这些特征的根本原因是共享信道，多个用户竞争使用单一信道，在这种情况下，用户之间距离不可能太大，在一定范围以内，参与共享的用户数量也不能太多。参与分享的用户数目太多，也起不到共享作用。
    1、计算机网络可以分成两类
    （1）使用点到点连接的网络 —— 广域网
    （2）使用广播信道（多路访问信道，随机访问信道）的网络 —— 局域网
     关键问题：如何解决对信道的争用
    2、解决信道争用的协议称为介质访问控制协议MAC（Medium Access Control）是数据链路层协议的一部分

    广域网中使用的都是点到点全双工通信，信道时时刻刻为发送点准备，任何时刻有数据都可以发送，可能存在容量限制，受限于点到点连接的带宽限制。并非使用了点到点信道就可以进行实时的传输，点到点可以保证任何时候都可以有信道使用，但仍然存在数据传输的容量问题。

    多路访问信道和随机访问信道都意味着同一个事物。篮球场、足球场就是一种共享资源，课外打篮球是没有协商组织。