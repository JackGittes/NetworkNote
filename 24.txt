计算机网络原理笔记 24
局域网技术（四）
作者：赵明心    日期：2019/03/13

无冲突协议

预约不一定所有站点都预约完成才发送。
1、BRAP —— 具有轮换优先权的广播识别协议
（1）按序轮转分配各站的发送权
（2）预约时间片的个数和工作站数相等
这个在实际网络中使用的比较少。

2、令牌协议
网络中流转着一个被称为“令牌Token”的帧，一个节点要发送数据必须首先截获令牌，由于网络中只有一个令牌，从而不会产生冲突。

令牌只有一个，代表了信道的使用权，谁获得令牌谁发送数据，发送完毕再释放令牌。令牌无论是顺时针还是逆时针都是环形移动。没数据的时候，令牌会在环路中转圈。令牌协议中有一定风险性，位图机制中没有权限机制，即时预约失败也只会影响一次发送，也不会影响其他站点的发送。但是令牌环网不同，令牌环网中的令牌帧是一个01串，相当于一个特殊的数据包，数据包在传输过程中可能发生丢失。一旦丢失，哪个站点都无法获得令牌，所以令牌环网中必须设置监督管理站，监督管理站可以防止令牌丢失，监督管理站的目的就是在一个最大的流转上限时间(每个站点都发送数据，令牌转一圈的时间)上，监督令牌状态。超过最大流转时间则认为令牌丢失，监督管理站会重新生成令牌。

今天令牌环网已经很少使用，但是令牌机制仍然在计算机网络中有应用，令牌代表了在网络中进行数据发送的能力。

5.3 传统以太网

以太网大体可以分成传统以太网、高速以太网和无线以太网。
IEEE 802.3和Ethernet
1、发展历史
    （1）ALOHA系统
    （2）ALOHA+载波监听
    （3）Xerox设计了2.94Mbps的采用CSMA/CD协议的Ehternet
    （4）Xerox，DEC，Intel共同制定了10Mbps的CSMA/CD以太网标准
    （5）IEEE定义了采用1-坚持型CSMA/CD技术的802.3局域网标准，速率从1M到10Mbps，802.3标准与以太网协议略有差别。Ethernet和IEEE 802.3的帧格式不同。

802.3协议与以太网协议几乎一样。以太网诞生于1973年一个在校博士生。施乐公司最早是2.94M，并没有取得太大的成功，真正的开始是在10M以太网的诞生，这时候以太网在市场上规模不断扩大。以太网标准是一个企业标准，而不是国际标准。从我们现在能看到的网卡实现里面，802.3和以太网实际上一样的，两种帧格式都可以被网卡识别。802.3标准的制定实际上就是参考了以太网的标准，国际标准的制定一般都会参考市场上某种产品为基线，以太网已经是事实上的国际标准。

5.3.1   传统以太网的种类
    1、传统以太网可使用的传输媒体有四种：
    （1）铜缆（粗缆和细缆）
    （2）铜线（双绞线）
    （3）光缆
    2、四种不同的物理层
    ——————————————————————————————————————————————————————
                  以太网媒体接入控制MAC
    ——————————————————————————————————————————————————————
    10 BASE 5    10 BASE 2    10 BASE T       10 BASE F
      粗缆         细缆         双绞线            光缆

    物理层类型：<传输速率><传输方式><网段最大长度>

    传统以太网并没有涵盖无线以太网，无线以太网出现时间比有线以太网晚很多。数字代表传输速率，BASE代表传输方式，后面的表示传输介质。以太网发展中出现过宽带传输的，但是宽带传输只存在了很短暂的时间，并没有得到市场的认可，而BASE类型得到了广泛应用。宽带传输逐渐退出了传输系列。MAC层协议是相同的，都是802.3，1-坚持型CSMA协议。

    现在的主机上很少见到独立网卡，现在主板集成度越来越高，不需要外接插口的网卡，没有独立的接口不代表没有网卡。

5.3.2   网卡作用
    1、网络接口板又被称为通信适配器（adapter）或网络接口卡NIC(Network Interface Card)，或“网卡”
    2、网卡的主要功能
    （1）进行串行、并行转换
    （2）对数据进行缓存
    （3）在计算机的操作系统安装设备驱动程序
    （4）实现以太网协议
    网卡跟外面的网络如何连接是可以看到的，网卡通过五类线、超五类线等双绞线和外部网络连接。网卡的内部和主机CPU等联通，外部与交换机、路由器联通。

    网卡在计算机内部，作为接口部件，在跟其他部分交互的时候是并行通信，计算机内部CPU、存储器都是并行通信，ISA总线、ESA总线扩展至PCI总线，其并行度在不断扩展，8、16、32宽度的总线，一次分别可以传输1、2、4个字节。而串行传输方式是一个位一个位传输，五类线虽然传输8根，实际有用的是4根，这4根线有两根是发送，两根是接收，两根一次只发送一个数据位，分成两路走，是为了实现平衡（差分）传输。

    网卡内外数据的传输通信方式不同，所以需要进行串并转换，通过缓存数据再拼接成并行格式进行并行化。

    网卡的使用必须有驱动程序，很多情况下，我们是没有驱动的概念。很多时候设备都是即插即用的，无需安装驱动，这主要是今天的操作系统功能非常强大，几乎已经包括了所有常见外设的驱动程序。当接入外设的时候，操作系统对外设进行自动识别，并进行配置。典型的是显卡、网卡、声卡、鼠标，这些设备是主机的基本构件，这些构件也有相应的统一标准，操作系统可以直接支持。但是在上个世纪90年代的时候，鼠标也需要安装驱动程序。

    
    3、网卡连接：
    主机中的所有重要部件都是总线连接起来的，总线类似于计算机网络中的共享广播信道，总线控制器是一个唯一仲裁判断是哪个设备在使用总线。

    计算机：

                                                       至局域网
    CPU ———— 高速缓存 ———— 存储器          网络接口卡 ————————————>
                       |                   |           串行通信
                       |    并行通信        |
        IO总线 <——————————————————————————————————> 

    4、网卡地址
    （1）在局域网中，硬件地址又称为物理地址，或MAC地址、网卡地址
    （2）802标准中所说的“地址”严格地讲应当是每个站的名字或标识符
    （3）地址类型
        a、单播（unicast）帧（一对一）
        b、广播（broadcast）帧（一对全体）
        c、多播（multicast）帧（一对多）
    
    网卡地址是网络中唯一标识网卡位置的标识。局域网中，三种地址类型主要以接收端数量来区分，一个站点发送数据帧，如果只有一个接收方，就是单播。广播地址，IP地址全1，表示广播，这是唯一的。而多播地址表示部分站点接受，广播帧可以认为是特殊的多播帧，所有成员都加入主播组就是广播。单播和广播比较容易区分和实现，多播比较复杂。

    5、网卡地址结构

    十六进制表示的EUI-48地址：AC-DE-48-00-00-80
    
    注意字节顺序，存在BIG-ENDIAN和LITTLE-ENDIAN，802.3~802.6字节顺序有不同，不同协议中的先发数据位和存储数据位是不等同的。

    二进制表示的EUI-48位地址：

               <——————机构唯一标志符OUI————>|  <————————————扩展标志符——————————>|
    字节顺序     第1         第2         第3    第4          第5             第6
    高位在前   101011001  011110010  01000000  00000000  00010000       
    802.5      最高位最先发送
    802.6

    此处略去一张图，网卡地址结构。具体的实现无论是BIG还是LITTLE ENDIAN是没有区别的，只需要明确自己的实现方式。

    机构唯一标志符可以称为网卡的生产厂商号，前24位是厂商号，后24位是产品序列号。作为一个网卡生产厂商，必须向国际地址分配机构申请厂商号。在前24中还有I/G控制位，一般表示全球通用还是局域通用，今天基本是全球地址，网卡在全球地址是唯一的。

    网卡地址在主机中是不可更改的，不过有黑客可以根据驱动程序做手脚，将发出的MAC地址改成和源端不一致，这个发出不一致不代表修改了MAC地址，只是修改了发出数据的内容。MAC地址不可更改，也是MAC地址被称为物理地址的原因，而IP地址是可以更改的。

    6、10 BASE 5连接示意
    此处略去一张图。早期的10 BASE 5连接器比较复杂，而且只实现了链路层功能，物理层功能需要外面的MAU收发设备完成，连接器是DB-15标准连接器。

    10 BASE 5的组网是比较麻烦的，需要有专门的连接器，而且导线比较粗，不过10 BASE 5出现时间不算长，之后是10 BASE 2，10 BASE 2持续了很长时间。