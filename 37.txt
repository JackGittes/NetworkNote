计算机网络原理笔记  37
广域网技术（五）
作者：赵明心    日期：2019/04/08

广域网甚至是互联网中的重要内容：路由选择、拥塞控制已经讲解完毕。尽管互联网可以指物理层、链路层到网络层，但更多的时候讲的广域网还是网络层。本节主要讲解广域网实例。

6.4 网络互联
    1、互联网（internet）：两个或多个网络构成互联网
    2、因特网（Internet）：最大的互联网
    3、多种不同网络（协议）存在的原因：
        （1）历史原因：不同公司的网络产品大量使用
        （2）价格原因：网络产品价格低，更多的人有权决定使用何种网络
        （3）技术原因：不同网络采用不同技术、不同硬件、不同协议

    注意小写的互联网是概念实例，而大写的因特网是现实世界中的具体实例。校园内的互联网也是一种互联网，基本技术与因特网类似，但是属于intranet。广域网覆盖范围可以很大，接受的用户数量也不受限制，但是为什么不会全球用户一起接入到一个广域网？例如海信厂家生产的电视机可以满足需求，但是不同厂商生产的产品仍然是有差别的。从价格、售后、历史上来说，各种彩电产品都有不同。互联网也是类似的，存在多种不同规格的互联网。

    新建的网络由于不能彻底推翻已有的网络，所以需要有兼容性。网络的类型从规模上而言，可以划分成广域网和局域网，那么互联也有不同的分类。

6.4.1   网络互联的分类
    1、广域网和广域网的互联
        如两个X.25网络的互联
    2、广域网和局域网的互联
        如Ethernet和ATM的互联
    3、局域网和局域网的互联
        如无线局域网与Ethernet的互联
    4、两个局域网通过广域网的互联
        如两个Ethernet通过帧中继网互联
    
    校园网是典型的局域网之间的互联。两个局域网也可以通过广域网互联。当然还有一些不合理的连接方式，例如两个广域网通过局域网连接起来，这个连接就是不合理的。从表面上看，这些不同网络的相互连接有些是技术原因，例如广域网和局域网之间互联就是技术上不同的互联，还有局域网与局域网之间的互联。

    技术上趋同的或者技术上一样的网络，相互连接，移动的GSM和联通的GSM的技术上没有区别，但是联通和移动的网络是两家不同的网络，技术上却是相同的。我们说网络的不同是在管理和经营上不一样，有时候网络的不同点就不体现在技术上，而在于管理经营上。联通内部用户通话和联通、移动用户相互通话就不一样，存在着管理因素。

    管理因素造成的不同也算是两个不同的网络之间的互联。

6.4.2   网络互联设备
    1、中继器（repeater）
        （1）物理层设备，在电缆段之间拷贝比特
        （2）对弱信号进行放大或再生，以便延长传输距离

        中继器不能完成异构网络的连接，中继器主要是为了延伸网络距离，客观上做不到不同网络的连接，只是扩大了网络的范围。这个扩大也只是在一定的距离内延伸。
    2、网桥（bridge）
        （1）数据链路层设备，在局域网之间存储转发帧
        （2）网桥可以改变帧格式

        网桥实现的是局域网之间的连接，不能连接广域网，网桥可以实现异构局域网的互联，例如历史上出现的以太网和令牌环网的互联。
    3、路由器（router）
        （1）网络层设备，在网络之间存储转发包
        （2）必要时，做网络协议转换
    
        路由器是今天网络互联今天使用最广泛的设备。当连接的是IP网络和AppleTalk网络或者IPX网络的时候，就需要进行协议转换，不过今天比较少，因为今天的互联网主要是IP协议的。所以今天的中低端路由器不支持网络协议转换。
    4、网关（gateway）
        （1）传输网关（transport gateway）
        （2）应用网关（application gateway）
    
        网关其实是涵盖了运输层和应用层，但是统称为网关，运输层是端到端通话，源端和目标端之间的通话会被网关截断，借助传输网关进行转接到对方的网关。传输层网关今天使用的已经不是很多了，使用多的主要是应用层网关。例如在IP上网的时候使用代理服务器，这时候使用的就是应用层网关。

        使用代理服务器，在2000年左右的时候，校园网没有出国权限，出国的费用也很昂贵，有时候查询国外的资料就需要访问国外的站点，采取的方式就是使用代理服务器，代理服务器具有出国权限，先委托代理服务器然后再由代理服务器出国，免费代理服务器一般有两种，一种是机主主动开放的代理，一种是恶意植入了后门，利用其出国权限形成了代理。应用网关需要支持特定的应用协议，例如IE浏览器需要支持HTTP协议和FTP协议，但是使用代理网关访问特定的应用服务可能做不成，例如QQ游戏，QQ游戏使用的HTTP协议和FTP协议，这个时候使用应用网关就没有用。

        安全网关是基于安全任务的网关，例如身份认证，校园的数字图书馆，内部访问没有任何限制，但是在家里的时候查找和浏览一些摘要是可以的，但是没有办法下载内容，这个时候会发现权限不够。学校为了方便进行在校外访问校内的文献资源，学校就会设置专门的网关，设置了代理网关之后，就可以在校外先连接到设置的代理网关再从网关访问校内资源。

6.4.3   网络互联设备工作层次含义
    1、网络互联设备需要加载的最高层协议
    2、互联网络的该层及以下各层协议可以相同也可以不同，但是该层以上协议必须相同
    3、网络互联设备按照该层地址进行数据转发

    互联设备也挂了层的概念，N层互联设备，这就意味着N层设备，例如路由器是第三层设备，那么路由器就必须加载到网络层协议，只加载到链路层协议是没有办法进行网络层协议数据转发的。但是传输层和应用层协议，路由器可以加载但不是必须的。

    路由器做不到安全网关的转换，必须在源端和客户端安装数字隧道的协议转换，路由器无法完成。路由器可以完成网络层协议的转换。互联设备有一个特定层次，只能认识自身层次转发的目标，例如路由器只认识目标方的IP地址但是不认识目标方的MAC地址。

    现实中的IP路由器工作在网络层，实现IP协议的数据包转发，但是IP路由器上可以有应用层协议，多数IP路由器也有应用层协议，例如网络管理协议，这时候路由器可以作为被管理设备而存在，例如我们可以看到路由器转发了多少分组之类的信息，这些都是需要在路由器和管理端之间建立制定管理协议。这时候的路由器充当了端端会话的一个端点。但是如果没有网络管理协议的话，这个时候路由器仅仅是作为互联设备而工作的，不再具有端端会话功能，网桥类似地也可以具有端端会话的端点身份。当作为端端会话的端点存在的时候，就可以加载网络的整个协议，从物理层到应用层。

6.4.4   路由器和网桥
    1、相同点：可以实现LAN互联，与网桥实现LAN互联区别
    2、不同点：
        （1）路由器互联的LAN网络层协议可不同
        （2）路由器避免广播风暴
        （3）路由器转发效率低于网桥转发数据的效率
        （4）路由器可完成LAN与WAN的互联

    因为路由器是实现的网络层互联，所以网络层协议可以不同。但是网桥属于链路层设备，所以网桥无法连接不同的网络协议。网桥不能避免广播风暴，网桥相对于共享式集线器而言可以大幅度降低广播信号，但是无法彻底消除。广播风暴的存在对于用户而言带来的影响就是网络规模不能大，路由器的网络规模可以大。

    在网桥和路由器都实现LAN互联的情况下，路由器的效率低于网桥。

接下来介绍几个广域网实例，这些实例可能没有直接接触过，但是也需要了解。

6.5 广域网实例
    1、X.25网就是X.25分组交换网，它是在二十多年前根据CCITT（即现在的ITU-T）的X.25建议书实现的计算机网络
    2、X.25只是一个对公用分组交换网络接口的规约。X.25所讨论的都是以面向连接的虚电路服务为基础。

    第一个广域网实例就是X.25网络，计算机发展历史中，最先出现的是广域网，局域网是80年代伴随着PC机的大规模出现才出现的。早期的计算机都是大中型机，一般都是广域网连接的。X.25网络应用于ARPANET，干线网络只有64KB。但是在今天肯定是不够用的，64KB对于传输控制协议来说都是很难的。
    
    X.25网络在计算机网络历史中扮演了非常重要的角色。我国在80年代因为政治原因与美国有一些分歧，当时虽然已经有了IP协议和互联网，但是国内是无法接触的，我们国家当时就基于X.25网络，因为这个技术出现的比较早，美国已经没有办法再封锁。

    X.25网络有时候涵盖物理层、链路层、网络层，有时候仅仅指网络层接口。因为X.25网络是电信运营商经营的，所以提供的服务是比较有保障的，以虚电路服务为主。电缆和微波的误码率较高，X.25网络在其中做了大量的工作来提高数据传输的可靠性。但是因为可靠性保障工作的存在，所以网络的吞吐量不高。不过好在早期网络的吞吐量需求也不高，基本都是以文本传输为主，传输的信息基本都是一些通告、信件。

6.5.1   X.25的DTE-DCE接口

        X.25接口                                          X.25接口
    DTE----------DCE----------------VC1--------------DCE---------DTE
                  |
                  |-----------------VC2--------------DCE---------DTE
                                                         X.25接口
                        X.25公用分组交换网

    DTE是数据终端设备，可以理解为主机，DCE是数据通信设备，可以理解为家里的ADSL，相当于接入网络的设备。DTE、DCE之间有一个接口，ADSL和主机的接口在今天是标准的以太接口，X.25的接口是一个广域接口，但是DCE是一个转发设备，真正的控制命令是由DTE发出来的，DCE需要完成数据打包、信号调制等任务。DCE和DCE的连接需要借助虚电路连接，这个通路是虚电路并不是真正的电路，DCE、DCE之间可以建立多个虚电路，多个虚电路的建立完成并发通信，但是这个并发通信是有数量限制的，这在网络建设与规划的时候会设置这个数量限制。

    现实当中的X.25网和ATM网的虚电路其实都有两种模式，一种是交换模式，一种是永久模式，交换式虚电路在会话完成之后拆除，适合通信量比较小的会话。如果两个用户之间通话频度高，但是单次通信数据量可多可少，总的通话时间很长，这时候用交换式虚电路带来的问题是电路的创建和拆除代价也是很大的，为了避免这种情况，就有了永久虚电路。永久虚电路就类似于专线电话，专线电话在摘机的时候不需要拨号，而且通话对象是固定的，例如国家电网里的载波通话，上一个站和下一个站之间是直接连接的，两个节点间享用专用电路资源，交换式虚电路使用的是共享资源，交换式虚电路可以出现呼叫不成功的情况，拨打100次可能存在一两次不同的情况。

    在X.25网络中也设计了永久虚电路，类似于专用电话，只需要有专用的虚电路号，这个是网络管理部门在接入网络的时候创建的，用户无法自行建立专用虚电路。