计算机网络原理笔记 23
局域网技术（三）
作者：赵明心    日期：2019/03/09

    解决信道争用的协议统称介质访问控制协议。MAC协议有多种协议，现在的以太网802.3协议是使用最为广泛的，CSMA/CD，载波侦听访问。

5.3.1   信道的静态分配
    将广播信道分配成多个子信道，利用信道的多路复用技术来实现静态分配。这些划分策略包括了时分、频分、码分等多种技术。这些站点的接入是唯一的入口，子信道是固定的，所以不需要协商机制，而且没有冲突。

    1、频分多路复用FDM（波分复用WDM）
    （1）原理：将频带平均分配给每个要参与通信的用户
    （2）优点：适合于用户较少，数目基本固定，各用户的通信量都较大的情况
    （3）缺点：无法灵活适应站点数及其通信量的变化
    2、时分多路复用TDM
    （1）原理：每个用户拥有固定的信道传送时槽
    （2）优点：适合于用户较少，数目基本固定，各用户的通信量都较大的情况
    （3）缺点：无法灵活适应站点数及其通信量的变化

    子信道跟站点是对应的，信道资源平均分配给各个站点使用，信道资源使用合理需要通过是否信道总是在传输信号来看。并非每个站点都有子信道就会提高利用率。每个站点什么时候发数据发多少是不可估计的，最后会导致有的站点子信道不够用，有的站点子信道长期没有使用。静态分配没有按照发送数据量的需求进行分配，各种静态分配方式的优缺点是相同的。

5.3.2   信道的动态分配
    1、动态分配
    局域网都采用动态分配策略，即根据当前对信道请求的情况动态协调各用户对信道的使用权。
    
    类别：（1）冲突协议（2）无冲突协议

    ALOHA冲突协议
    1、上世纪70年代，Norman Abramson设计了ALOHA协议
    （1）目的：解决信道的动态分配，基本思想可用于任何无协调关系的用户争用单一共享信道使用权的系统
    （2）分类：纯ALOHA协议和时间片ALOHA协议

    2、纯ALOHA协议
    （1）基本思想：用户有数据要发送时，可以直接发至信道，然后监听信道看是否产生冲突，若产生冲突，则等待一段随机的时间重发。

    3、时间片ALOHA协议
    （1）基本思想：把信道时间分成离散的时间片，片长为一个帧所需的发送时间。每个站点只能在时间片开始时才允许发送。其他过程与纯ALOHA协议相同。

    ALOHA冲突协议在现在使用的不多，因为冲突太大。不管是产生数据还是发送都不关心信道状态，就算是信道有站点在使用，仍然会发送数据，一种改进是先检查信道有没有已经被使用，如果有其他站点在使用，就不发送，如果是空闲就使用。但是信道空闲的时候发送数据也可能会有冲突，但是冲突概率会很低。

    CSMA协议
    CSMA协议在有线、无线以太网中使用非常广泛。

    1、载波监听多路访问协议
    2、载波监听（Carrier Sense）
    （1）站点在为发送帧而访问传输信道之前，首先监听信道有无载波，若有载波，说明已有用户在使用信道，则不发送帧以避免冲突。

    3、多路访问（Multiple Access）
    多个用户共用一条信道

    4、三个变种
    （1）1-坚持型CSMA（1-persistent）
    （2）非坚持型CSMA（nonpersistent）
    （3）p-坚持型CSMA（p-persistent）

    判定信道的忙和空闲，信道中始终是有信号存在的，因为有噪声信号，而CSMA关注的是载波信号，物理层已经预先规定了调制或者编码方式，生成的信号是载波信号，载波信号和噪声信号是有明显区别的。侦听到信道空闲之后的策略不同产生了三个变种。

    1-坚持型CSMA（永久坚持）
    这是以太网中使用的CSMA策略。
    1、基本原理：
    （1）若站点有数据发送，先监听信道
    （2）若站点发现信道空闲，则发送
    （3）若信道忙，则继续监听直至发现信道空闲，然后完成发送
    （4）若产生冲突，则等待一随机时间，然后重新开始发送过程
    2、协议特点
    （1）优点：减少了信道空闲时间
    （2）缺点：增加了发生冲突的概率
    （3）广播延迟对协议性能的影响：广播延迟越大，发生冲突的可能性越大，协议性能越差

    同一时刻如果多个站点要发送，它们都检测到信道空闲的话，这时仍然会有冲突。

    非坚持型CSMA
    1、基本原理
    （1）若站点有数据发送，先监听信道
    （2）若站点发现信道空闲，则发送
    （3）若信道忙，等待一随机时间，然后重新开始发送过程
    （4）若产生冲突，等待一随机时间，然后重新开始发送过程

    2、协议特点：
    （1）优点：减少了冲突的概率
    （2）缺点：增加了信道空闲时间，数据发送延迟增大
    （3）信道效率比1-坚持CSMA高，传输延迟比1-坚持CSMA大

    p-坚持型CSMA
    1、适用于分槽信道（信道是划分时间片的）
    2、基本原理：
    （1）若站点有数据发送，先监听信道
    （2）若站点发现信道空闲，则以概率p发送数据，以概率q=1-p延迟至下一个时槽发送。若下一个时槽仍空闲，重复此过程，直至数据发出或时槽被其他站点所占用。
    （3）若信道忙，则等待下一个时槽，重新开始发送
    （4）若产生冲突，则等待一随机时间，然后重新开始发送
    
    永久坚持和非坚持式都是适用于连续时间信道的，p-坚持是针对分时信道的。仅仅从单一站点和信道关系来看，推迟到下一个时槽的方式对自己是不利的，但是从网络的整体来看，如果多个站点都有数据发送需求，通过控制p的大小可以是总冲突概率下降。

    无论如何改进，冲突协议的冲突都是无法避免的，这些改进途径都是使冲突率下降，不同的控制策略有不一样的冲突概率。

5.3.3   CSMA/CD
    1、冲突
    （1）当多个站同时在总线上发送数据时，总线上的信号电压摆动值将会增大（互相叠加）
    （2）当一个站检测到的信号电压摆动值超过一定的门限值时，就认为总线上至少有两个站同时在发送数据，表明产生了冲突

    2、冲突检测
    （1）当两个帧发生冲突时，两个被损坏帧继续传送毫无意义，而且信道无法被其他站点使用，对于有限信道来讲，这是很大的浪费
    （2）如果站点边发送边监听，并在监听到冲突之后立即停止发送，可以提高信道的利用率，因此产生了CSMA/CD

    在无线以太网中使用的是CSMA/CA,是冲突避免的协议。

    3、CSMA/CD
    （1）站点使用CSMA协议进行数据发送
    （2）在发送期间如果检测到冲突，立即停止发送，并发出一个瞬间干扰信号，使所有的站点都知道信道发生了冲突
    （3）在发出干扰信号后，等待一段随机时间（称为退避），再重复上述过程

    冲突检测只有发送数据结点才会检测，没参与数据发送的结点并不清楚信道有没有冲突，因此需要检测到冲突的站点必须发出瞬时干扰信号，而且不止发送一次，因为冲突的肯定不止一个站点，这个中间会有时间差异，存在广播延时，冲突时的物理位置和延时都不一样。冲突产生之后，每个检测冲突的站点都要发送干扰。

    CSMA还有几个变种，没有细讲。

5.3.4   无冲突协议
    无冲突协议在局域网，还有以太网中使用的比较少，因为无冲突协议控制开销比较大。想要做到无冲突，站点发送数据之前必须要和其他站点进行协商，站点如果只和信道协商或者不协商，是无法实现无冲突的。

5.3.5   基本位图协议（A Bit-Map Protocol）
    基本位图协议工作原理
    （1）共享信道上有N个站，竞争周期分为N个时槽，如果有一个站有帧发送，则在对应的时槽内发送比特1
    （2）N个时槽之后，每个站都知道哪个站要发送帧，这时按站序号发送

    预约阶段            数据传送阶段

    系统中10个站点就有10个时序号，真正数据发送的时候，就在有数据发送的站点位置设置为1，在预约阶段，每个站点固定在自己的时序里发送结果，