计算机网络原理笔记 20
数据链路控制（七）
作者：赵明心    日期：2019/03/02

有限状态机来描述状态，在状态较多的情况下很难使用，所以有Petri网方法。

4.6.7   Petri网
    1、一个Petri网的结构元素包括：
    （1）位置（place）：描述系统状态，用一个圆圈表示
    （2）变迁（transition）：描述修改系统状态的时间，用一个长方形或线段表示
    （3）弧（arc）：描述状态与事件之间的关系，包括输入弧和输出弧，用有向弧表示
    2、活动元素 ———— 标记（token）
    包含在位置中，用点表示。此处略去一张说明图。

    Petri网单独描述发送、接收方，将三个参与者、状态单独描述。

    PPP协议将用有限状态图描述。

4.7 Internet中的数据链路层协议
    在最底下的网络层是主机网络层，或者叫主机-接口层，这层对应于开放互联参考模型的最底下两层。实际TCP/IP协议中没有最底下两层。

    1、点到点通信的两种主要情形
    （1）路由器到路由器（router-router leased line connection）
    （2）通过modem拨号上网，连到路由器或接入服务器（dialup host-router connection）

    一台主机，要想接入Internet，接入方法两大类，一类为拨号接入，一类为专线接入。在我们电脑连入ISP的时候，需要有一个设备，早期为调制解调器，现在是ADSL路由，用户需要有一个接入路由或主机。拨号和专线的区别是，专线是随时存在并且可以接入的，最简单的例子是学校的网络中心，不管中间多少集线器和交换机，都需要接入网络中心的路由器，这个路由器就是一个接入设备。通过学校网络接入Internet的方式就是专线，因为随时可以接入。而拨号的方式，需要申请线路，比如拨号的时候输入用户名和口令来申请接入。

    此处讲解的Internet接入主要是针对拨号接入的。

    再来看第二种情况，路由器到路由器，路由器1连接到路由器2的时候，二者可以实现数据转发，例如使用RS232，此时相当于定义了物理层标准，但还没有定义数据链路层的方式。当两个结点之间没有数据链路层同时又需要接入Internet的时候，就需要这样一个协议来完成数据链路层工作。

4.7.1   SLIP协议
    1、SLIP —— Serial Line IP
    看名字可以知道这个协议是为IP协议设计的，补充的数据链路层协议是为了实现向IP协议接入的。数据链路层应该实现五大功能，但是此协议实际只完成了一个，即数据同步。

    （1）1984年，Rick Adams提出，RFC1055，发送原始IP包，用一个标记字节（0xC0）来定界，采用字符填充技术。
    （2）新版本提供TCP和IP头压缩技术，RFC 1144
    （3）存在的问题：
        -- 不提供差错校验
        -- 只支持IP
        -- IP地址不能动态分配
        -- 不提供身份认证
        -- 多种版本并存，互联困难
    填充只是前后添加起止标记。现在这个协议已经很少使用了。不提供差错控制，意味着在进行拨号连接的时候，有错数据也会送给对方，由于对方也使用的是SLIP，所以对方提交的也是错误数据。IP地址不进行动态分配，对ISP提供商来说，就很难工作，因为每次接入实际是在可用IP地址池中进行动态分配的，SLIP不支持动态IP。不提供身份认证，这样对ISP也是很困难的，因为任何用户接入都需要提供服务。

4.7.2   PPP（Point-to-Point Protocol）协议
    1、RFC 1661，RFC 1662，RFC 1663
    2、提供差错校验，支持多种协议，允许动态分配IP地址，支持认证等
    3、以帧为单位发送，而不是原始IP包
    4、包括两部分：
    （1）链路控制协议LCP
        建立、配置和测试多种物理层服务：modem，HDLC串线，SDH/SONET，以太网等
    （2）网络控制协议NCP
        建立、配置不同网络层协议

    现在用的最多的是PPP协议，对应三个标准RFC 1661~1663。PPP协议为了实现这些提升，必须加足够多的信息来改进这些帧，需要更多控制信息。LCP和NCP都处于数据链路层，其中LCP和物理层打交道，NCP和网络层打交道。PPP协议甚至可以直接建立在以太网之上，例如PPPoE，就是指建立在以太网之上的PPP协议。设计NCP就是为了向上支持更多更丰富的网络层协议。

4.7.3   PPP的帧格式

    先发送
      |
                首部                      IP数据报             尾部
      ————————————————————————       ———————————————   ——————————————————
      F     A     C        协议          信息部分        FCS         FCS
      7E    FF    03                                                7E
字节   1     1     1        2          不超过1500字节     2            1
—————————————————————————————————— PPP帧 ————————————————————————————————

    （1）标记域：01111110，字符填充
    （2）地址域：11111111
    （3）控制域：缺省值为00000011，表示无序号帧，缺省情况下，PPP不提供使用序号和确认的可靠传输；但是在不可靠线路上，也可使用有序号的可靠传输
    （4）协议域：指示净负荷中是何种包，比如IP，IPX等，缺省大小为2个字节
    （5）净负荷域：变长，缺省为1500字节
    （6）校验和域：2或4个字节

    实际上对于PPP协议来说，是不需要地址的，地址域全部都是1，这是跟PPP协议的应用环境有关的。PPP是为了解决主机和接入结点之间的关系，就是链路的两端，所以不需要指定。控制字段也是简化的00000011，这属于信息帧。PPP协议对数据根本没有编号，不提供使用序号和确认机制。没有序号是不需要应答的，因为不知道应答的是哪个帧。所以提供的不可靠传输，如果使用序号，例如在无线局域网当中，这个就类似于HDLC协议的机制。

    注意增加的协议字段，协议字段指明的是，在有效数据中，即在信息部分当中所封装的上层信息的类型，也即哪种协议调用的PPP协议。例如IP协议或IPX协议。这个数据段非常重要，它标志了是哪个进程去处理这个数据。

    帧校验使用的也是CRC校验，可以使用32位的生成多项式。

4.7.4   PPP工作过程（简单状态图）
    示意性说明PPP协议的工作，也即一旦两个结点的物理链路建立之后，两个结点如何建立数据链路，如何使用数据链路层协议控制数据传输。

    此处略去一个状态图。

    初始是静止状态，任何结点没有工作，当检测到载波的时候开始工作，即已经有一个结点向另一个结点发出了二进制位流，一般情况下是用户向路由发送。当有载波到达，开始建立数据链路，首先是保证信道的顺畅，之后是LCP开始工作，双方协商通信的选项，例如此次通信针对不可靠的通信环境就需要带序号有确认机制的传输。协商完通信参数之后，进行身份认证，输入用户名、口令等等。认证成功之后进入后续处理，认证失败则终止连接。后续是NCP协议的阶段，完成一些配置工作，配置完成之后开始进入真正的传输阶段。最后有通信结束的阶段，再次进入静止状态。