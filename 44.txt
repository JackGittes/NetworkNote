计算机网络原理笔记 44
Internet基本原理（六）
作者：赵明心    日期：2019/04/20

7.5.1 IPv6的设计目标
    1、IPv6支持几乎无限大的地址空间
    2、减少路由表的大小，使得路由器能够更快地处理包
    3、提供更好的安全性，实现IP级的安全
    4、支持多种服务类型，并支持组播
    5、允许新旧协议共存一段时间
    6、协议必须支持可移动主机和网络

    IPv6几乎可以给全球的每一粒沙子分配一个地址，地址急剧扩大造成网络号增加，所以IPv6也在想办法控制路由表的规模，避免每次需要查询一个很长的路由表项。

7.5.2   IPv6的地址表示
    1、16字节地址表示成用冒号(:)冒号分隔开的8组，每组4个16进制位，例如：
        8000：0000：0000：0000：0123：4567：89AB：89AB：CDEF
    2、由于有很多“0”，有三种优化表示：
        （1）一组或多组16个“0”可以被一对冒号替代，但是一对冒号只能出现一次，上面的地址可以表示成：
            8000::123:4567:89AB:CDEF
        （2）IPv4地址可以写成一对冒号和用“.”分隔 的十进制数，例如::192.31.20.46
    
7.5.3   IPv6的报文格式
    IPv6的报文头部分包含的信息比IPv4少，包含版本、通信量类、流标号、有效载荷长度、下一个首部、跳数限制、源地址（128bit）、目的地址（128bit）、扩展首部/数据，IPv6有效载荷可以达到64KB，IPv6为了提高传输的速度，使得每次传送更多传送数据，所以对报头进行了大大简化。IPv6的基本头部固定在40个字节，源地址和目的地址已经占据了32个字节，剩下的8个字节来存储其他信息。

7.5.3.1 IPv6数据报的首部
    1、将首部长度变为固定的40个字节，称为基本首部（base header）
    2、将不必要的功能取消了，首部的字段数减少到只有8个
    3、取消了首部的校验和字段，加快了路由器处理数据报的速度

    校验和被转移到别的层次去做。

7.5.3.2 IPv6分组头
    1、版本：值为6
    2、通信量类：为了区分不同的IPv6数据报的类别或优先级
    3、流标号：流是互联网络上从特定源点到特定终点的一系列数据报，所有属于同一个流的数据报都具有同样的流标号
    4、有效载荷长度：用来指示IP包中40字节包头后面部分的长度，最大值是64KB

    源地址和目的地址在协议中是不可少的，所以一定要包含。

    目前定义了6种类型的扩展包头，主要用于安全相关的。

7.5.4 IPv4到IPv6的过渡方法
    在一定时间内都会存在IPv4和IPv6两种协议。
    1、双协议栈 Dual stack approach
    同时安装两种协议，并可完成协议间的相互转换

    2、隧道技术 Tunneling
    IPv6分组作为IPv4分组的负载在IPv4路由器间传送

    双协议栈

    双协议栈主要关心在边界的路由器，可以实现V6和V4协议的转换，
    特点：源地址和目的地址保持不变

    隧道技术

    IPv6数据需要经过IPv4网络的时候，借助隧道数据进行传输，在边界路由的地方会把IPv6数据整个封装到IPv4的数据中。在隧道技术中，封装的源和目的地址发生了改变，但是IPv6部分的地址没有改变。

7.6 Internet路由协议
    Internet路由基本概念
    1、为了便于管理，Internet将整个互联网络划分为相对较小的自治系统（AS,autonomous systyem）
    2、一个自治系统内的所有网络通常属于一个行政单位（例如一所公司、大学或政府部门）
    3、一个自治系统的所有路由器在本自治系统内都必须是连通的

    小型网络和大型网络的路由策略肯定是有所不同的。Internet划分自治系统是很重要的，一个自治系统可以是相对独立的单位，一个公司、大学、城市，按照粒度不同可以划分出不同的自治系统。数据从一个自治系统发送到另一个自治系统上，划分成若干块之后，路由表的规模也会减小，查找速度也会提高。

    内部网关协议IGP ——————— 外部网关协议EGP ———————— 内部网关协议IGP

    Internet就分成两大块，内部路由和外部路由

7.6.1   Internet路由协议分类
    1、内部网关协议IGP（interior gateway protocol）
    自治系统AS内使用的路由算法，RIP、OSPF

    2、外部网关协议EGP（exterior gateway protocol）
    自治系统AS之间使用的路由算法，BGP

7.6.1.1 RIP路由信息协议
    Routing information protocol
    RIP是一种分布式的基于距离向量的路由选择协议，RIP具有距离向量算法的基本特点。

    距离的定义
    1、RIP使用跳数度量来衡量到达目的站的距离，不能同时使用多种度量，例如时延等
    2、RIP允许一条路径最多只能包含15个路由器
    3、“距离”的最大值为16时即相当于不可达，可见RIP只适用于小型互联网

    RIP协议的三个要点：
    1、仅和相邻路由器交换信息
    2、交换的信息是当前路由器所知道的全部信息，即自己的路由表
    3、按固定的时间间隔来交换路由信息，例如每隔30秒

    链路状态是全网内交换信息。

    RIP协议报文格式（此处略去一张图）

    RIP协议的优缺点：
    1、RIP协议优点就是实现简单，开销较小
    2、缺点：
        （1）当网络出现故障时，要经过比较长的时间才能将此信息传送到所有的路由器
        （2）RIP限制了网络的规模，它能使用的最大距离为15
        （3）路由器之间要交换完整路由表，随着网络规模的扩大，开销也就增加。

7.6.1.2 内部网关路由协议OSPF
    开放最短路径优先 Open Shortest Path First
    OSPF是一种公开发表的分布式的链路状态协议

    OSPF的几个要点
    1、向本自治系统中的所有路由器发送信息（洪泛）
    2、发送的信息就是与本路由器相邻的所有路由器的链路状态（即本路由器都和哪些路由器相邻，以及该链路的度量）
    3、支持多种距离衡量尺度，例如，物理距离、延迟等。

    OSPF的特点：
    （1）开放、公开发表
    （2）支持多种距离衡量尺度
    （3）路由更新过程收敛的快
    （4）动态算法
    （5）负载平衡
    （6）适量的安全措施
    （7）支持的隧道技术

    OSPF路由协议的网络类型
    （1）广播多路访问型 点到多点型
    （2）非广播多路访问型 NBMA
    （3）点到点型

    OSPF的分层路由
    1、为了使OSPF能够用于规模更大的网络，OSPF将一个自治系统由划分为若干个更小的范围，叫做区域（areas）
    2、每一个区域都有一个32 bit的区域标识符（用点分十进制表示）
    3、设定一个主干区域（backbone area），标识符规定为0.0.0.0，用于连通其他各区域
    4、利用洪泛法交换链路状态信息的范围局限于每一个区域而不是整个的自治系统，这就减少了整个网络上的通信量
    5、在一个区域内部的路由器只知道本区域的完整网络拓扑，不需要知道其他区域的网络拓扑情况
    6、OSPF更加适合大规模的网络路由

    OSPF的协议操作
    具体工作过程如下：
    1、建立路由器的邻接关系
    2、发现路由器
    3、选择适当的路由器
    4、维护路由信息

    此处略去一张图（OSPF分组）
    OSPF分组类型
    1、类型1：问候（Hello）分组
    2、类型2：数据库描述（Database Description）分组
    3、类型3：链路状态请求（Link State Request）分组
    4、类型4：链路状态更新（Link State Update）分组，用洪泛法对全网更新链路状态
    5、类型5：链路状态确认（Link State Acknowledgement）分组

    OSPF的基本操作
    1、确定可达性               问候
                                问候
    2、达到数据库的同步         数据库描述
                                数据库描述
                                数据库描述
                                数据库描述
    3、新情况下的同步           链路状态请求
                                链路状态更新
                                链路状态确认